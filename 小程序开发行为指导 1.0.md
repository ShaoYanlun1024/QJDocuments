# 小程序开发行为指导 1.0

修订人|版本号
-|-
张金龙|1.0

---

## 目录
- [设计背景](#设计背景)
- [小程序目录结构](#小程序目录结构)
- [具体实现](#具体实现)
- [开发注意事项](#开发注意事项)
- [前端项目构建上线](#前端项目构建上线)
---

> ## # 设计背景

现阶段小程序开发持续进行中，为了统一小程序项目结构，降低维护成本。该文章只针对小程序原生开发。

[**<p align="right">>>返回目录<<</p>**](#目录)

> ## # 小程序目录结构

```
├── app.js              //  小程序入口文件
├── app.json            //  小程序配置文件
├── app.wxss            //  小程序样式文件
├── request             //  请求数据方法
│    └── api.js             //  接口文件
├── common              //  公用文件
│   ├── image               //  公用image文件
│   ├── static              //  静态数据文件
│   └── style               //  样式文件
├── components          //  组件&模板
│   ├── componen            //  组件
│   └── template            //  模板
├── doc                 //  doc文件
├── mixins              //  混入文件
│   ├── components          //  组件混入
│   ├── page                //  页面混入
│   └── public              //  公共混入
├── pages               //  页面
└── utils               //  工具文件夹
```

[**<p align="right">>>返回目录<<</p>**](#目录)

> ## # 具体实现

1. `request`文件夹内部文件，文件名需要与`pages`文件夹内部统一，不同页面使用不同的`js`文件划分，在`pege`中统一统一引用对应`page`名的文件，方便调用以及维护，若存在多个页面都使用同一个方法，将该请求方法写入`public.js`文件内统一管理。

request封装

```
serverHttp.js

export class ServerHttp {
  http({ url, data, method }, flag) {
    flag && wx.showLoading({ title: "加载中...",mask:true });
    return new Promise((resolve, reject) => {
      wx.request({
        url,
        data,
        method,
        success(res) {
          let data = res.data;
          data.StatusCode === 200 ? resolve(data.Model) : reject(data);
          flag && wx.hideLoading();
        },
        fail() {
          wx.showToast({
            title: "网络不给力！",
            image: "../../common/image/icon/noNet.png"
          });
        },
        complete(data){
          data.statusCode>=500 && wx.showToast({
            title: "服务器离线",
            image: "../../common/image/icon/error_server.png"
          });
        }
      })
    })
  }
}

// 使用 serverHttp

// public.js

import {serverHttp} from "./serverHttp.js";
import {api} from "./api.js";

let request = new serverHttp();

export defalut let login = (data) => {
    //  可以根据实际项目情况对参数进行更改
    //  更改传参形式
    return request({method:"post",data,url:api[login]})
}

// app.js

//  把所有生成方法挂载到app中
let serverMethods = require("./public.js");
app({
    ...serverMethods
})

// 使用挂载方法

app.login({data}).then().catch();

```

2. `common/style`文件夹内部需要放入`页面`、`组件`、`模板`抽离出来的公共样式，每个以组件名称命名，并写入注释。使用文件夹的形式把`页面`、`组件`、`模板`样式区分开，参考[CSS 开发规范](http://git.allhome.com.cn/NetWorksDatas/Public/standard/blob/master/css%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%201.1.md)。

3. `components`文件夹内部分为`componen`和`template`两个文件夹分别放入组件和模板。

4. 大型项目使用`mixins`文件夹内部分为三个文件夹，以`组件`和`页面`划分内部文件分别以页面或组件名称命名。`public`文件存入组件和页面通用的一些方法。小型项目不建议使用，会增加项目结构复杂度。

5. `api.js`文件里面写入所有文件的接口，可以考虑按照页面划分。

[**<p align="right">>>返回目录<<</p>**](#目录)

> ## # 开发注意事项

1. 地狱回调问题

由于小程序提供的`API`都是使用回调函数方式，在使用`API`开发过程中可能会导致地狱回调，需要把所使用到的小程序方法使用`Promise`进行二次封装。[Promise基本使用](https://zhuanlan.zhihu.com/p/44433872)。把封装好的`API`全部导出，在`page`文件中引用，调用不同的方法。

2. 子页面父页面传值问题

小程序中可以通过`getCurrentPages()`获取到当前存在的页面数组，数组中的每一项就是所打开页面的顺序，通过`index`值就可以拿到对应页面中的`data`以及所需要操作的函数。完成赋值等操作。

3. 父页面子页面传值问题

小程序提供页面相互传值，使用小程序提供的[“API”](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.redirectTo.html)，但是需要通过类似`web`端`get`方式传参，建议对其方法进行封装，改成以传参形式，传入`data`形式进行参数传递。这种传参不允许参数是复合形式，如果传入的参数是复合类型，建议暂时把参数挂载到`app.globalData`当中，不使用参数时将其销毁即可。

[**<p align="right">>>返回目录<<</p>**](#目录)

> ## # 前端项目构建上线

项目上线之前确认，所用`API`接口是否在页面中已经部署。以免上线后接口无法调用，导致页面数据获取失败，无法成功获取数据。

[**<p align="right">>>返回目录<<</p>**](#目录)